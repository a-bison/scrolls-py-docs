<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>scrolls API documentation</title>
<meta name="description" content="Scrolls is a small, embeddable scripting engine with an emphasis on abuse prevention, designed to be used
in bots for chat services such as Discord …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>scrolls</code></h1>
</header>
<section id="section-intro">
<p>Scrolls is a small, embeddable scripting engine with an emphasis on abuse prevention, designed to be used
in bots for chat services such as Discord.</p>
<h1 id="what-is-this">What is this?</h1>
<p>Scrolls is designed to allow the execution of arbitrary untrusted code, without
opening yourself up to possible sandbox escapes. The original intended purpose
of this scripting engine is to allow users of Discord bots to create their own
custom commands with a simple scripting language. Because of this origin, there
are a few key design elements:</p>
<ul>
<li>The syntax for statements resembles discord bot prefix commands.</li>
<li>The interpreter is designed to be as pluggable as possible - it will only
ever do what you tell it to.</li>
<li>Optimization isn't much of a priority - most commands will involve CPU or
network-intensive operations, so the interpreter itself doesn't really need to
be fast.</li>
</ul>
<h1 id="what-is-this-not">What is this not?</h1>
<ul>
<li>Scrolls is not meant for performance. If you want a decently fast embedded scripting
language, try <a href="https://www.lua.org/">Lua</a>.</li>
<li>Scrolls is meant for scripting <em>services</em> - chatbots, web interfaces, etc. While it
can be used locally, there are better options when you don't need to worry about
sandboxing.</li>
</ul>
<h1 id="quickstart">Quickstart</h1>
<ul>
<li>Read <a href="#language-overview">Language Overview</a> for an introduction to the Scrolls language.</li>
<li>See <code><a title="scrolls.interpreter" href="interpreter.html">scrolls.interpreter</a></code> for an introduction to embedding Scrolls.</li>
<li>See <code><a title="scrolls.ast" href="ast.html">scrolls.ast</a></code> for an explanation of the parser.</li>
</ul>
<h1 id="language-overview">Language Overview</h1>
<p>Scrolls was originally designed to combine existing discord bot commands
into new ones. As such, the statement syntax was heavily based on bash/sh.
Other influences include python, lisp, and perl.</p>
<h2 id="statements">Statements</h2>
<p>There are three types of statements in Scrolls.</p>
<h3 id="command">Command</h3>
<pre><code class="language-scrolls"># syntax:
NAME SPACE_DELIMITED_ARGUMENTS
</code></pre>
<p>Similarly to shell scripts, the most basic form of a scrolls script is just a
sequence of commands:</p>
<pre><code class="language-scrolls">print hello world
print this is an example
do-something 10 20
</code></pre>
<p>A command name may be any string that does not contain <code>$ ^ ! ( ) { } ; #</code>. Arguments
are set apart by spaces. Commands may be put on the same line using semicolons:</p>
<pre><code class="language-scrolls">print hello world; print this is an example
do-something 10 20
</code></pre>
<p>You can terminate lines with semicolons if you want, but this is optional.</p>
<h3 id="control">Control</h3>
<pre><code class="language-scrolls"># syntax:
!NAME(SPACE_DELIMITED_ARGUMENTS) STATEMENT
</code></pre>
<p>Control structures all follow the same syntax in Scrolls. <code>!</code>, followed by the control name,
followed by arguments, followed by a single statement. Scrolls supports a number of traditional
control structures, including <code>while</code>, <code>if</code>, and <code>for</code>. </p>
<p>In Scrolls, control structures are pluggable. Adding new ones does not increase the
complexity of syntax; they're technically function calls, not keywords.
Because of this, some shorthand structures are provided as well, such as <code>repeat</code>:</p>
<pre><code class="language-scrolls">!repeat(4) print &quot;hello world&quot;

# equivalent to:
print hello world
print hello world
print hello world
print hello world
</code></pre>
<h3 id="block">Block</h3>
<pre><code class="language-scrolls"># syntax:
{
    STATEMENT
    STATEMENT
    ...
}
</code></pre>
<p>Blocks group together multiple statements into a single one. They can be placed anywhere a statement
is expected. This is used to achieve more recognizable control structures with code blocks:</p>
<pre><code class="language-scrolls">!repeat(4) {
    print hello
    print world
}

# equivalent to:
print hello
print world
print hello
print world
print hello
print world
print hello
print world
</code></pre>
<h2 id="comments">Comments</h2>
<p>Comments may be defined with the <code>#</code> character.</p>
<pre><code class="language-scrolls"># This is a comment.
print hello world# comments can border literals, though it doesn't look great.
print foo bar #comments! can( contain) any; character, and last until end of line.
</code></pre>
<h2 id="variable-substitution">Variable Substitution</h2>
<p>Scrolls supports variable expansion with <code>$</code>. Variables may be set with the built-in <code>set</code>
command.</p>
<pre><code class="language-scrolls">set test hello world
print $test

# prints:
# hello world
</code></pre>
<p>There is also a built in <code>for</code> control call, which will run a code block repeatedly
with different parameters.</p>
<pre><code class="language-scrolls">!for(x in 1 2 3 4 5) {
    print $x
}

# prints:
# 1
# 2
# 3
# 4
# 5
</code></pre>
<h2 id="expansion-calls">Expansion Calls</h2>
<p>In addition to variable expansion, expansions may call into some code, in which case
the code will determine what the expansion is replaced with. For example,
<code>$(select hello world)</code> will randomly be replaced by <code>hello</code> 50% of the time, and <code>world</code> otherwise. This may
be used to randomly select arguments to commands, or randomly select the commands
themselves:</p>
<pre><code class="language-scrolls">command $(select arg1 arg2)
$(select command1 command2) hello world
</code></pre>
<p>The general form of an expansion call is <code>$(NAME SPACE_DELIMITED_ARGUMENTS)</code>.
Expansion calls and variable references may be nested indefinitely:</p>
<pre><code class="language-scrolls">set v test
command $(select $(select arg1 arg2 $v) $v)
</code></pre>
<h2 id="functions-defining-commands">Functions / Defining Commands</h2>
<p>Custom commands and substitution calls may be defined through the <code>def</code> control
structure.</p>
<p><strong>Defining a Command</strong></p>
<pre><code class="language-scrolls">!def(commandname arg1 arg2) {
    print $arg1
    print $arg2
}
commandname hello world
</code></pre>
<p><strong>Defining an Expansion Call</strong></p>
<pre><code class="language-scrolls">!def(square x) {
    return $(* x x)
}
print &quot;4 squared is&quot; $(square 4)
</code></pre>
<p>The key difference is the presence of the <code>return</code> command. If a <code>def</code> block
contains a <code>return</code> statement, it defines an expansion call. If not, it defines
a new command.</p>
<p>Note that it is currently not possible to define custom control structures with
Scrolls code. See <a href="interpreter.html#extensions">Extensions</a> for more info on how to
define custom control structures.</p>
<h2 id="math">Math</h2>
<p>Arithmetic and logic operators are implemented as expansion calls. This results
in a prefix syntax that <a href="https://en.wikipedia.org/wiki/Polish_notation">may look familiar</a> if
you've ever used lisp:</p>
<pre><code class="language-scrolls"># converts celsius to fahrenheit
!def(c_to_f c) {
    return $(+ $(* $c 1.8) 32)
}
</code></pre>
<h2 id="datatypes">Datatypes</h2>
<p>Scrolls is a weakly typed language, and its only real datatype is the string (specifically
utf-8 strings). All calls will convert to other datatypes internally as needed, and will
always return strings. That being said, built-in Scrolls calls will follow certain rules
when interpreting strings.</p>
<h3 id="numeric">Numeric</h3>
<p>For the purposes of arithmetic and numeric comparisons:
- Floats are strings such as <code>3.5</code>, <code>-0.12</code>, <code>1.0</code>, etc.
- Integers are any numeric string with no decimal point; <code>1</code>, <code>-32</code>, etc.</p>
<p>Most arithmetic operators operate as follows:
- If all inputs are formatted as integers, the output will be too.
- If one or more inputs are formatted as floats, the output will be formatted as float.</p>
<p>For example:
- <code>$(+ 1 2 3)</code> will result in <code>6</code>
- <code>$(+ 1 2 3.0)</code> will result in <code>6.0</code></p>
<p>Notable exceptions to this are:
- Division (<code>/</code>) will always output floats.</p>
<h3 id="strings">Strings</h3>
<p>Strings are the default datatype in Scrolls, and do not need to be enclosed in quotes.
If you need to include special characters or newlines in strings, you may use double
quotes:</p>
<pre><code class="language-scrolls">print &quot;hello world (foo bar) {this is fine}&quot;
print &quot;spacing      is      preserved&quot;
print &quot;newlines
are
allowed
too&quot;
</code></pre>
<p>In order to include characters like <code>"</code>, you can use escape sequences:</p>
<pre><code class="language-scrolls"># prints &quot;quoted string&quot;
print &quot;\&quot;quoted string\&quot;&quot;
</code></pre>
<p>Nearly everything is a string, including all call names and variable references. As such,
call names may be stored in variables as a primitive form of indirection:</p>
<pre><code class="language-scrolls">!for(operator in + - * /) {
  print $($operator 5 8) 
}

# Equivalent to...
print $(+ 5 8)
print $(- 5 8)
print $(* 5 8)
print $(/ 5 8)
</code></pre>
<p>See <a href="https://github.com/a-bison/scrolls-py/tree/master/examples/arithmetic.scrl">arithmetic.scrl</a> for an example of this idea. </p>
<p>Using quoted literals, we can make the "everything is a string" idea a bit more obvious:</p>
<pre><code class="language-scrolls"># Does the same thing as the above example
!&quot;for&quot;(&quot;operator&quot; &quot;in&quot; &quot;+&quot; &quot;-&quot; &quot;*&quot; &quot;/&quot;) {
  &quot;print&quot; $($&quot;operator&quot; &quot;5&quot; &quot;8&quot;)
}
</code></pre>
<h3 id="structures-lists-etc">Structures (Lists, etc.)</h3>
<p>There are no dedicated datastructures in Scrolls, however there is built in support
for manipulating space-delimited lists of strings referred to as <em>vectors</em>. For example,
here is how to iterate over each element in a vector:</p>
<pre><code class="language-scrolls">set vector 1 2 3 4 5
!while($(not $(vempty? $vector))) {
  print $(vhead $vector)      # vhead returns the first item in a vector
  set vector $(vtail $vector) # vtail returns all but the first item in a vector
}
</code></pre>
<p>Of course, this operation is common enough that a dedicated control structure is
provided for it:</p>
<pre><code class="language-scrolls">set vector 1 2 3 4 5
!for(x in $^vector) {
  print $x
}
</code></pre>
<p><code>$^</code> is the <em>vector expansion operator</em>. It will split the value of the expansion
along spaces, and pass the pieces as separate arguments. The best way to illustrate the
difference is with an example:</p>
<pre><code class="language-scrolls">set vector 1 2 3 4 5
!for(x in $^vector) {
  print $x
}

# prints:
# 1
# 2
# 3
# 4
# 5
</code></pre>
<p>Contrast with removing <code>^</code>: </p>
<pre><code class="language-scrolls">set vector 1 2 3 4 5
!for(x in $vector) { # note the ^ is missing here! 
  print $x
}

# prints:
# 1 2 3 4 5
</code></pre>
<p>Above, the vector is being passed as a single, unsplit string. The primary use of
the <code>^</code> operator is to pass vectors into calls that do not understand them directly. For
example, the <code>shuffle</code> builtin, which shuffles its arguments, but does not understand
vectors:</p>
<pre><code class="language-scrolls"># will always print 1 2 3 4 5
set vector 1 2 3 4 5
print $(shuffle $vector) # shuffle is only taking 1 argument here

# will shuffle as expected, ex 3 5 1 2 4
print $(shuffle $^vector) # note the added ^, shuffle is taking each element
                          # in $vector as its own argument
</code></pre>
<h1 id="further-reading">Further Reading</h1>
<ul>
<li>See <code><a title="scrolls.builtins" href="builtins.html">scrolls.builtins</a></code> for a reference of commands, control structures and expansions
included with Scrolls.</li>
<li>See the <a href="https://github.com/a-bison/scrolls-py/tree/master/examples">examples directory</a>
for more complete examples of Scrolls code.</li>
<li>See the source code: <a href="https://github.com/a-bison/scrolls-py">https://github.com/a-bison/scrolls-py</a></li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Scrolls is a small, embeddable scripting engine with an emphasis on abuse prevention, designed to be used
in bots for chat services such as Discord.

.. include:: pdoc/scrolls.md
&#34;&#34;&#34;

from .ast import *
from .builtins import *
from .containers import *
from .errors import *
from .interpreter import *

__version__ = &#34;0.2.0&#34;</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="scrolls.ast" href="ast.html">scrolls.ast</a></code></dt>
<dd>
<div class="desc"><p>The parser implementation …</p></div>
</dd>
<dt><code class="name"><a title="scrolls.builtins" href="builtins.html">scrolls.builtins</a></code></dt>
<dd>
<div class="desc"><p>Built in Scrolls language features …</p></div>
</dd>
<dt><code class="name"><a title="scrolls.containers" href="containers.html">scrolls.containers</a></code></dt>
<dd>
<div class="desc"><p>Container utilities.</p></div>
</dd>
<dt><code class="name"><a title="scrolls.datatypes" href="datatypes.html">scrolls.datatypes</a></code></dt>
<dd>
<div class="desc"><p>Datatype conversions for Scrolls. This module defines tools for writing <code><a title="scrolls.interpreter.CallHandler" href="interpreter.html#scrolls.interpreter.CallHandler">CallHandler</a></code> implementations
that act like the built-in …</p></div>
</dd>
<dt><code class="name"><a title="scrolls.errors" href="errors.html">scrolls.errors</a></code></dt>
<dd>
<div class="desc"><p>Errors not dependent on any specific Scrolls types …</p></div>
</dd>
<dt><code class="name"><a title="scrolls.ext" href="ext/index.html">scrolls.ext</a></code></dt>
<dd>
<div class="desc"><p>Extensions for Scrolls …</p></div>
</dd>
<dt><code class="name"><a title="scrolls.interpreter" href="interpreter.html">scrolls.interpreter</a></code></dt>
<dd>
<div class="desc"><p>The interpreter implementation …</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#what-is-this">What is this?</a></li>
<li><a href="#what-is-this-not">What is this not?</a></li>
<li><a href="#quickstart">Quickstart</a></li>
<li><a href="#language-overview">Language Overview</a><ul>
<li><a href="#statements">Statements</a><ul>
<li><a href="#command">Command</a></li>
<li><a href="#control">Control</a></li>
<li><a href="#block">Block</a></li>
</ul>
</li>
<li><a href="#comments">Comments</a></li>
<li><a href="#variable-substitution">Variable Substitution</a></li>
<li><a href="#expansion-calls">Expansion Calls</a></li>
<li><a href="#functions-defining-commands">Functions / Defining Commands</a></li>
<li><a href="#math">Math</a></li>
<li><a href="#datatypes">Datatypes</a><ul>
<li><a href="#numeric">Numeric</a></li>
<li><a href="#strings">Strings</a></li>
<li><a href="#structures-lists-etc">Structures (Lists, etc.)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#further-reading">Further Reading</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="scrolls.ast" href="ast.html">scrolls.ast</a></code></li>
<li><code><a title="scrolls.builtins" href="builtins.html">scrolls.builtins</a></code></li>
<li><code><a title="scrolls.containers" href="containers.html">scrolls.containers</a></code></li>
<li><code><a title="scrolls.datatypes" href="datatypes.html">scrolls.datatypes</a></code></li>
<li><code><a title="scrolls.errors" href="errors.html">scrolls.errors</a></code></li>
<li><code><a title="scrolls.ext" href="ext/index.html">scrolls.ext</a></code></li>
<li><code><a title="scrolls.interpreter" href="interpreter.html">scrolls.interpreter</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>