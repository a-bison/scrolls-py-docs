<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>scrolls.interpreter API documentation</title>
<meta name="description" content="The interpreter implementation â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>scrolls.interpreter</code></h1>
</header>
<section id="section-intro">
<p>The interpreter implementation.</p>
<p>This module is the main point of interaction for most uses of Scrolls. The <code><a title="scrolls.interpreter.run.Interpreter" href="run.html#scrolls.interpreter.run.Interpreter">Interpreter</a></code> implements functions that
interpret Scrolls scripts. The <code><a title="scrolls.interpreter.state.InterpreterContext" href="state.html#scrolls.interpreter.state.InterpreterContext">InterpreterContext</a></code> class is responsible for tracking the state of the Scrolls
interpreter.</p>
<h1 id="using-the-interpreter">Using the Interpreter</h1>
<h2 id="quickstart">Quickstart</h2>
<p>Basic usage of the interpreter is straightforward. Instantiate <code><a title="scrolls.interpreter.run.Interpreter" href="run.html#scrolls.interpreter.run.Interpreter">Interpreter</a></code>, and configure it with the desired
features, either from <code><a title="scrolls.builtins" href="../builtins.html">scrolls.builtins</a></code>, or custom modules. Then, the interpreter may be used to run Scrolls scripts.</p>
<pre><code class="language-py">import scrolls

# Create an interpreter. Note that an interpreter created this 
# way will not actually do anything. It's the responsibility of 
# the user to configure with the desired language features.
interpreter = scrolls.Interpreter()

# Configure the interpreter with the base language.
# scrolls.base_config is provided to make this common task
# a bit easier.
scrolls.base_config.configure(interpreter)

# Configure with stdio commands like input, and print
interpreter.command_handlers.add(scrolls.StdIoCommandHandler())

# Run your script.
script = &quot;&quot;&quot;
!repeat(4) {
    print &quot;Hello world!&quot;
}
&quot;&quot;&quot;
interpreter.run(script)

# Note: This will print
# Hello world!
# Hello world!
# Hello world!
# Hello world!
</code></pre>
<p><code>scrolls.__main__</code> implements a bare minimum standalone Scrolls interpreter with this interface. Take a look if you
need a more concrete example.</p>
<h2 id="extensions">Extensions</h2>
<p>Of course, the main usage of Scrolls is not as a standalone language, but as an engine embedded in a parent application.
Eventually, you'll most likely need to implement extensions to the language.</p>
<p>The primary method of extending Scrolls is through call handlers (<code><a title="scrolls.interpreter.callhandler.CallHandler" href="callhandler.html#scrolls.interpreter.callhandler.CallHandler">CallHandler</a></code>).</p>
<h3 id="call-types">Call Types</h3>
<p>Calls come in three different types, however all calls are fundamentally function calls. Most of the time, they will
call into some python code, but support is offered for calls written in Scrolls code themselves (see <code>!def</code>).</p>
<h4 id="command-calls">Command Calls</h4>
<p>Command calls are what most languages would refer to as "statements".</p>
<pre><code class="language-scrolls">print &quot;Tell me your name:&quot;
input name
print &quot;Hello,&quot; $name
</code></pre>
<p>In the above example, <code>print</code> and <code>input</code> are command calls. Command calls do not return anything. In <code><a title="scrolls.interpreter" href="#scrolls.interpreter">scrolls.interpreter</a></code>
terms, command calls are calls for which <code><a title="scrolls.interpreter.callhandler.CallHandler.handle_call" href="callhandler.html#scrolls.interpreter.callhandler.CallHandler.handle_call">CallHandler.handle_call()</a></code> returns <code>None</code>. Command calls are counted as
statements. See <code><a title="scrolls.interpreter.run.Interpreter.interpret_statement" href="run.html#scrolls.interpreter.run.Interpreter.interpret_statement">Interpreter.interpret_statement()</a></code>.</p>
<h4 id="expansion-calls">Expansion Calls</h4>
<p>Expansion calls are what most languages would refer to as "functions".</p>
<pre><code class="language-scrolls">print &quot;Here's a random choice:&quot; $(select foo bar baz)
print &quot;9 + 10 is:&quot; $(+ 9 10)
</code></pre>
<p>In the above example, <code>select</code> and <code>+</code> are expansion calls. Expansion calls always return strings. In <code><a title="scrolls.interpreter" href="#scrolls.interpreter">scrolls.interpreter</a></code>
terms, expansion calls are calls for which <code><a title="scrolls.interpreter.callhandler.CallHandler.handle_call" href="callhandler.html#scrolls.interpreter.callhandler.CallHandler.handle_call">CallHandler.handle_call()</a></code> returns <code>str</code>. Expansion calls are <strong>not</strong>
counted as statements, and must be used in the context of either a command call, or control call.</p>
<p>Note that even arithmetic operations like <code>+ - * /</code> are implemented as expansion calls.
See <code><a title="scrolls.builtins.ArithmeticExpansionHandler" href="../builtins.html#scrolls.builtins.ArithmeticExpansionHandler">ArithmeticExpansionHandler</a></code>.</p>
<h4 id="control-calls">Control Calls</h4>
<p>Control calls implement control structures.</p>
<pre><code class="language-scrolls">!repeat(4) {
    print &quot;Hello world!&quot;
}
!if($true) print &quot;This was a true statement.&quot;
</code></pre>
<p>In the above example, <code>repeat</code> and <code>if</code> are control calls. Control calls are unique in that they take a Scrolls
statement in addition to the normal call arguments. This can be used to implement common control structures like
<code>if</code>, <code>while</code>, etc. See <code><a title="scrolls.builtins.BuiltinControlHandler" href="../builtins.html#scrolls.builtins.BuiltinControlHandler">BuiltinControlHandler</a></code>. Control calls do not return anything, like command calls.
Control calls are counted as statements.</p>
<h3 id="implementing-call-handlers">Implementing Call Handlers</h3>
<p>The bare minimum for implementing a call handler is to implement the <code><a title="scrolls.interpreter.callhandler.CallHandler" href="callhandler.html#scrolls.interpreter.callhandler.CallHandler">CallHandler</a></code> protocol. Call handlers must implement
two functions:</p>
<ul>
<li><code>handle_call</code>: Called when a call is invoked.</li>
<li><code>__contains__</code>: Should return <code>True</code> if the call handler supports a call, i.e. <code>"call_name" in handler</code>.</li>
</ul>
<p>Let's make a simple command call handler for a call named <code>printargs</code>, which prints out all of the arguments passed to
it.</p>
<pre><code class="language-py">import scrolls

# Create interpreter
interpreter = scrolls.Interpreter()

# Create your handler
class PrintArgsHandler:
    def handle_call(self, ctx: scrolls.InterpreterContext) -&gt; None:
        if ctx.call_name == &quot;printargs&quot;:
            for arg in ctx.args:
                print(arg)

    def __contains__(self, call_name: str) -&gt; bool:
        return call_name == &quot;printargs&quot;

# Add the handler to the interpreter
interpreter.command_handlers.add(PrintArgsHandler())

# Run a script containing your command:
interpreter.run(&quot;&quot;&quot;
printargs foo bar &quot;this is one argument&quot; baz
&quot;&quot;&quot;)

# NOTE - Prints
# foo
# bar
# this is one argument
# baz
</code></pre>
<h3 id="using-callbackcallhandler">Using <code>CallbackCallHandler</code></h3>
<p>The <code><a title="scrolls.interpreter.callhandler.CallHandler" href="callhandler.html#scrolls.interpreter.callhandler.CallHandler">CallHandler</a></code> protocol is deliberately left simple for maximum flexibility, but it's also kind of awkward for most
uses. A basic call handler is provided to handle boilerplate, <code><a title="scrolls.interpreter.callhandler.CallbackCallHandler" href="callhandler.html#scrolls.interpreter.callhandler.CallbackCallHandler">CallbackCallHandler</a></code>.
Let's implement <code>printargs</code> with <code><a title="scrolls.interpreter.callhandler.CallbackCallHandler" href="callhandler.html#scrolls.interpreter.callhandler.CallbackCallHandler">CallbackCallHandler</a></code>.</p>
<pre><code class="language-py">import scrolls

# Create interpreter
interpreter = scrolls.Interpreter()

# Create your handler
# Note that this may also use the shortcut: scrolls.CallbackCommandHandler,
# but it's the same thing.
class PrintArgsHandler(scrolls.CallbackCallHandler[None]):
    def __init__(self):
        super().__init__()
        self.add_call(&quot;printargs&quot;, self.printargs)

    def printargs(self, ctx: scrolls.InterpreterContext) -&gt; None:
        for arg in ctx.args:
            print(arg)

# Add the handler to the interpreter
interpreter.command_handlers.add(PrintArgsHandler())

# Run a script containing your command:
interpreter.run(&quot;&quot;&quot;
printargs foo bar &quot;this is one argument&quot; baz
&quot;&quot;&quot;)

# NOTE - Prints
# foo
# bar
# this is one argument
# baz
</code></pre>
<p><code><a title="scrolls.interpreter.callhandler.CallbackCallHandler" href="callhandler.html#scrolls.interpreter.callhandler.CallbackCallHandler">CallbackCallHandler</a></code> may be considered the base call handler class for most purposes. All builtin language features
are implemented with <code><a title="scrolls.interpreter.callhandler.CallbackCallHandler" href="callhandler.html#scrolls.interpreter.callhandler.CallbackCallHandler">CallbackCallHandler</a></code>. See <code><a title="scrolls.builtins" href="../builtins.html">scrolls.builtins</a></code>.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
The interpreter implementation.

.. include:: ./pdoc/interpreter.md
&#34;&#34;&#34;

from .callhandler import *
from .interpreter_errors import *
from .run import *
from .state import *
from .struct import *</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="scrolls.interpreter.callhandler" href="callhandler.html">scrolls.interpreter.callhandler</a></code></dt>
<dd>
<div class="desc"><p>Call handler protocols and implementations.</p></div>
</dd>
<dt><code class="name"><a title="scrolls.interpreter.interpreter_errors" href="interpreter_errors.html">scrolls.interpreter.interpreter_errors</a></code></dt>
<dd>
<div class="desc"><p>Interpreter-specific errors.</p></div>
</dd>
<dt><code class="name"><a title="scrolls.interpreter.run" href="run.html">scrolls.interpreter.run</a></code></dt>
<dd>
<div class="desc"><p>Code relating to the execution of <code><a title="scrolls.ast.syntax.AST" href="../ast/syntax.html#scrolls.ast.syntax.AST">AST</a></code> objects.</p></div>
</dd>
<dt><code class="name"><a title="scrolls.interpreter.state" href="state.html">scrolls.interpreter.state</a></code></dt>
<dd>
<div class="desc"><p>Implementation of interpreter state. Variables, open files, call stack, etc.</p></div>
</dd>
<dt><code class="name"><a title="scrolls.interpreter.struct" href="struct.html">scrolls.interpreter.struct</a></code></dt>
<dd>
<div class="desc"><p>Data structures used to implement the interpreter state.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#using-the-interpreter">Using the Interpreter</a><ul>
<li><a href="#quickstart">Quickstart</a></li>
<li><a href="#extensions">Extensions</a><ul>
<li><a href="#call-types">Call Types</a><ul>
<li><a href="#command-calls">Command Calls</a></li>
<li><a href="#expansion-calls">Expansion Calls</a></li>
<li><a href="#control-calls">Control Calls</a></li>
</ul>
</li>
<li><a href="#implementing-call-handlers">Implementing Call Handlers</a></li>
<li><a href="#using-callbackcallhandler">Using CallbackCallHandler</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="scrolls" href="../index.html">scrolls</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="scrolls.interpreter.callhandler" href="callhandler.html">scrolls.interpreter.callhandler</a></code></li>
<li><code><a title="scrolls.interpreter.interpreter_errors" href="interpreter_errors.html">scrolls.interpreter.interpreter_errors</a></code></li>
<li><code><a title="scrolls.interpreter.run" href="run.html">scrolls.interpreter.run</a></code></li>
<li><code><a title="scrolls.interpreter.state" href="state.html">scrolls.interpreter.state</a></code></li>
<li><code><a title="scrolls.interpreter.struct" href="struct.html">scrolls.interpreter.struct</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>